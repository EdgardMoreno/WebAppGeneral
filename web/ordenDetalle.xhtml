<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"      
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" >

    <!--<f:metadata>        
        <f:viewParam name="titulo" value="#{orderController.desTituloPagina}"/>
        <f:event type="preRenderView" listener="#{orderController.loadOrderDetails}"/>
    </f:metadata>-->

    <ui:composition template="./WEB-INF/facelets/templates/templatePrincipal.xhtml">

        <ui:define name="header">

            <style>
                    
                .panelIngresoDatosOrden {
                    position:relative;
                    float:left;
                    /*border: 1px solid black;*/
                    width: 71%;
                }

                .panelResumenOrden {
                    position:relative;
                    float:right;
                    width: 28%;
                    border: 1px inset #FFF;
                    background-color: #167F92;
                }
                
                .calcularVuelto{
                    border: 2px outset #FFF;
                    text-align: center;
                    height: 35px;
                    padding: 5px;
                    /*vertical-align: middle;*/                    
                }
                
                .style_label{text-align: right; font-weight: bold; font-size: 12px; padding: 3px; width: 150px; }
                .style_content{text-align: left; font-size: 13px; padding: 3px }

               

            </style>

            <script>
                
                function fnFinishOrder(){
                    fnShowDialogConfirm("form\\:idBtnHideFinishOrder","");
                    return false;
                }
                
                /*Funcion que permite Imprimir*/
                function fnImprimirVoucher() {                    
                    
                    var message = "¿Está seguro de IMPRIMIR VOUCHER?";
                    fnShowDialogConfirm('form\\:btnImprimirVoucher', message);
                    return false;
                }                             
                

            </script>
        </ui:define>

        <ui:define name="content">

            <div class="container" > 

                <div id="divResultadoValidacion"></div>

                <p:growl id="message" showDetail="true" />

                <div class="page-header" >
                    <h3>${orderController.desTituloPagina}</h3>
                </div>
                
                <!-- ****************************************************************************** -->
                <!-- BOTONES DE ACCION  -->
                <!-- ****************************************************************************** -->                
                <div class="offset-sm-2 col-sm-10">
                    <h:commandButton 
                                   value="Imprimir Voucher"                                   
                                   styleClass="btn btn-primary"
                                   onclick="return fnImprimirVoucher()" >
                    </h:commandButton>                    
                    <h:commandButton 
                                   value="Descargar PDF"                                   
                                   styleClass="btn btn-primary"
                                   actionListener="#{orderController.descargarComprobantePDF()}" >
                    </h:commandButton>                    
                    <h:commandButton value="Anular AUN NO FUNCIONA"                                     
                                     styleClass="btn btn-danger"
                                     onclick="return fnShowPopupAnularDocumento(#{orderController.sic1docu.idDocu})" rendered="false">
                    </h:commandButton>
                </div>
                <br/>
                <br/>
                
                <!-- ****************************************************************************** -->
                <!-- PANEL PARA INGRESO DE DATOS DE LA ORDEN -->
                <!-- ****************************************************************************** -->

                <div class="panelIngresoDatosOrden">
                    
                    <!-- ********************************** -->
                    <!-- LISTA DE DOCUMENTOS PADRE -->
                    <!-- *********************************** -->
                    
                    <div class="subtitulo" >
                        <h:outputLabel value="DOCUMENTOS PADRE" rendered="#{not empty orderController.lstDocusPadre}"/>
                    </div>                   
                    
                    <p:dataTable                                                        
                        var="item" 
                        rendered="#{not empty orderController.lstDocusPadre}"
                        value="#{orderController.lstDocusPadre}" 
                        style="margin-bottom:10px;padding: 0px; font-size: 11px">                                                        

                        <p:column headerText="No." width="25" style="padding: 1px;text-align: center">
                            <h:outputText value="#{orderController.lstDocusPadre.indexOf(item) + 1}" />
                        </p:column>                            

                        <p:column headerText="Evento" width="120" style="color: blue;text-align: center">
                            <h:outputText value="#{item.desDocu}" />
                        </p:column>

                        <p:column headerText="Fec. Registro" width="90">
                            <h:outputText value="#{item.fecDesde}" />
                        </p:column>

                        <p:column headerText="Cliente/Proveedor">
                            <h:outputText value="#{item.desPersClieprov}" />
                        </p:column>

                        <p:column headerText="Estado" width="80">
                            <h:outputText value="#{item.desEstadocu}" />
                        </p:column>

                        <p:column headerText="Mto. Pagado" width="75" style="text-align: right">
                            <h:outputText value="S/.#{item.numTotalpagado}" />
                        </p:column>

                        <p:column headerText="Total" width="80" style="text-align: right">
                            <h:outputText value="S/.#{item.numMtototal}" />
                        </p:column>

                        <p:column headerText="Modo Pago" width="110" style="text-align: center">
                            <h:outputText value="#{item.desModoPago}" />
                        </p:column>                        
                        
                        <p:column headerText="Responsable" width="100" style="text-align: center">
                            <h:outputText value="#{item.desPersCreador}" />
                        </p:column>                        
                    </p:dataTable>
                    <br/>
                    <!-- ********************************** -->
                    <!-- LISTA DE DOCUMENTOS HIJO -->
                    <!-- *********************************** -->
                    
                    <div class="subtitulo" >
                        <h:outputLabel value="DOCUMENTOS HIJO" rendered="#{not empty orderController.lstDocusHijo}"/>
                    </div>
                    
                    <p:dataTable                                                        
                        var="item" 
                        rendered="#{not empty orderController.lstDocusHijo}"
                        value="#{orderController.lstDocusHijo}" 
                        style="margin-bottom:10px;padding: 0px; font-size: 11px">                                                        

                        <p:column headerText="No." width="25" style="padding: 1px;text-align: center">
                            <h:outputText value="#{orderController.lstDocusHijo.indexOf(item) + 1}" />
                        </p:column>                            

                        <p:column headerText="Evento" width="120" style="color: blue; text-align: center">
                            <h:outputText value="#{item.desDocu}" />
                        </p:column>

                        <p:column headerText="Fec. Registro" width="90">
                            <h:outputText value="#{item.fecDesde}" />
                        </p:column>

                        <p:column headerText="Cliente/Proveedor">
                            <h:outputText value="#{item.desPersClieprov}" />
                        </p:column>

                        <p:column headerText="Estado" width="80">
                            <h:outputText value="#{item.desEstadocu}" />
                        </p:column>

                        <p:column headerText="Mto. Pagado" width="75" style="text-align: right">
                            <h:outputText value="S/.#{item.numTotalpagado}" />
                        </p:column>

                        <p:column headerText="Total" width="80" style="text-align: right">
                            <h:outputText value="S/.#{item.numMtototal}" />
                        </p:column>

                        <p:column headerText="Modo Pago" width="110" style="text-align: center">
                            <h:outputText value="#{item.desModoPago}" />
                        </p:column>                        
                        
                        <p:column headerText="Responsable" width="100" style="text-align: center">
                            <h:outputText value="#{item.desPersCreador}" />
                        </p:column>                        
                    </p:dataTable>  
                    
                    <!-- ********************************** -->
                    <!-- DETALLE DE LA OPERACION -->
                    <!-- *********************************** -->
                    
                    <table >
                        <tr>
                            <td colspan="2"><h4>Datos de la Operación</h4></td>
                        </tr>
                        <tr>                        
                            <td class="style_label">Fecha:</td>
                            <td class="style_content">${orderController.sic1docu.fecDesde}</td>
                        </tr>                        
                        <tr>                            
                            <td class="style_label">Nombre/R.Social:</td>
                            <td class="style_content">#{orderController.sic1idenpersId.codIden} - #{orderController.sic1pers.desPers}</td>
                            <td class="style_label">Por Recoger?:</td>
                            <td class="style_content">#{orderController.flgPorRecoger?'SI':'NO'}</td>
                        </tr>                        
                        <tr>
                            <td class="style_label" style="color: blue">Declarado a SUNAT?:</td>
                            <td class="style_content" style="color: blue">#{orderController.sic1docu.flgDeclaradosunat==1?'SI':'NO'}</td>
                            <td class="style_label">Precio con IGV?:</td>
                            <td class="style_content">#{orderController.sic1docu.flgPrecsinIGV==1?'NO':'SI'}</td>
                        </tr>                        
                        <tr>
                            <td class="style_label">Estado:</td>
                            <td class="style_content">#{orderController.sic1docu.sic3docuesta.desEsta}</td>
                            <td class="style_label">Motivo Nulidad:</td>
                            <td class="style_content">#{orderController.sic1docu.sic3docuesta.desNotas}</td>
                        </tr>
                    </table>
                   
                    
                    <!-- ****************************************************************************** -->
                    <!-- DETALLE DE PRODUCTOS -->
                    <!-- ****************************************************************************** -->
                    <h4>Detalle de Productos</h4>
                    <h:panelGrid id="pnDetOrder" columns="1" width="100%" >

                        <h:dataTable value="#{orderController.lstSic3docuprod}"
                                     var="item"
                                     id="idTableDetOrder"
                                     width="100%"
                                     styleClass = "table-bordered"                                         
                                     columnClasses = "table_style_id,
                                                      table_style_code,
                                                      table_style_description_medium,
                                                      table_style_price_small,
                                                      table_style_price_small_discount,
                                                      table_style_amount,
                                                      table_style_price_7x">

                            <h:column headerClass="table_style_id">
                                <f:facet name="header">Item</f:facet>#{item.id.numItem}
                            </h:column>                            
                            <h:column headerClass="table_style_code">
                                <f:facet name="header">Código</f:facet>#{item.sic1prod.codProd}
                            </h:column>
                            <h:column headerClass="table_style_description_medium">
                                <f:facet name="header">Descripción</f:facet>#{item.sic1prod.desProd}
                            </h:column>
                            <h:column id="idTablePrice" headerClass="table_style_price">
                                <div >
                                    <h:outputLabel value="S/." />
                                    <f:facet name="header">Precio</f:facet>#{item.numValor}
                                </div>
                            </h:column>
                            
                            <h:column  headerClass="table_style_price_small_discount">
                                <div >
                                    <h:outputLabel value="S/." />
                                    <f:facet name="header">Dscto</f:facet>#{item.numMtodscto}
                                </div>
                                
                                <f:facet name="footer">                                    
                                    <div class="table_style_total_price" style="color: red">
                                        <h:outputLabel value="S/." />
                                        #{orderController.numSumItemsDescuento}
                                    </div>
                                </f:facet> 
                                
                            </h:column>
                            
                            <h:column id="idTableAmount" headerClass="table_style_amount">
                                <f:facet name="header">Cantidad</f:facet>#{item.numCantidad}
                                
                                <f:facet name="footer">
                                    <div class="table_style_total_amount">
                                        #{orderController.numSumItemsAmount}
                                    </div>
                                </f:facet> 
                                
                            </h:column>
                            
                            <h:column headerClass="table_style_price_7x">
                                <div>
                                    <h:outputLabel value="S/." />
                                    <f:facet name="header">Total</f:facet>#{item.numValor * item.numCantidad}
                                </div>                                
                                
                                <f:facet name="footer">
                                    <div class="table_style_total_price">
                                        <h:outputLabel value="S/." />
                                        #{orderController.numSumItemsPrice}
                                    </div>
                                </f:facet>                                
                            </h:column>
                            
                        </h:dataTable>
                        
                        &nbsp;
                        <table width="500">
                            <tr>
                                <td class="compra_panelGrid_4">
                                    <h:outputLabel value="Nota:"/>
                                </td>
                                <td class="compra_panelGrid_2">
                                    <h:inputTextarea id="idDescripcion"
                                                     readonly="true"
                                                     rows="5"
                                                     cols="35"
                                                     value="#{orderController.sic1docu.desNotas }" />
                                </td>
                            </tr>
                        </table>  

                    </h:panelGrid>
                </div>


                <!-- ****************************************************************************** -->
                <!-- PANEL DEL RESUMEN DE LA ORDEN -->
                <!-- ****************************************************************************** -->

                <div class="panelResumenOrden">

                    <table width="100%" >
                        <tr>
                            <td colspan="2" style="color: white; padding: 20px 5px 10px; border-bottom: 2px inset #2C3259">
                                <strong><h4> RESUMEN DE LA ORDEN</h4></strong>
                            </td>
                        </tr>   
                        <tr>
                            <td><h:outputLabel value="" /></td>
                        </tr>
                    </table>
                    
                    <h:panelGroup  rendered="#{not empty orderController.itemsPayMode}">
                        <table width="100%" >
                            <tr>
                                <td class="compra_totales_label">
                                    <h:outputLabel value="Forma de Pago:" />
                                </td>
                                <td class="compra_totales_text">                                   
                                    <h:outputLabel value="#{orderController.sic1docu.objFormaPago.desGeneral}" />
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="compra_totales_label">
                                    <h:panelGroup id="idLabelNumVoucher" >
                                        <h:outputLabel value="Número Voucher(s):" rendered="#{not empty orderController.sic1docu.numVoucher}"/>
                                    </h:panelGroup>
                                </td>
                                <td class="compra_totales_text">
                                    <h:panelGroup id="idTextNumVoucher" >
                                        <h:inputText disabled="true" value="#{orderController.sic1docu.numVoucher}" styleClass="form-control" rendered="#{not empty orderController.sic1docu.numVoucher}"/>
                                    </h:panelGroup>
                                </td>
                            </tr>

                            <tr style="display: #{not empty orderController.sic1docu.objTipoTarjeta.desGeneral?'':'none'}">
                                <td class="compra_totales_label">
                                    <h:panelGroup id="idLabelTipotarjeta" >
                                        <h:outputLabel value="Tipo Tarjeta:"/>
                                    </h:panelGroup>
                                </td>
                                <td class="compra_totales_text">
                                    <h:panelGroup id="idTextTipotarjeta" >                                        
                                        <h:outputLabel value="#{orderController.sic1docu.objTipoTarjeta.desGeneral}" />
                                    </h:panelGroup>
                                </td>

                            </tr>
                            <tr>
                                <td class="compra_totales_label">
                                    <h:panelGroup id="idLabelMtoTarjeta" >
                                        <h:outputLabel value="Mto. Tarjeta:"  />
                                    </h:panelGroup>
                                </td>
                                <td class="compra_totales_text">
                                    <h:panelGroup>
                                        <h:outputLabel value="S/." />
                                        <h:outputLabel value="#{orderController.sic1docu.numMtotarjeta}" />
                                    </h:panelGroup>
                                </td>
                            </tr>
                            <tr>
                                <td class="compra_totales_label">
                                    <h:outputLabel value="Mto. Depo/Efectivo:"/>
                                </td>
                                <td class="compra_totales_text">
                                    <h:outputLabel value="S/." />
                                    <h:outputLabel value="#{orderController.sic1docu.numMtoefectivo}" />                                    
                                </td>
                            </tr>
                        </table>
                                              
                    </h:panelGroup>                    

                    <h:panelGroup id="pnTotals">

                        <table style="width: 100%">
                            
                            <tr>
                                <td class="compra_totales_label">
                                    <h:outputLabel value="Total Descuento:"/>
                                </td>
                                <td class="compra_totales_text" style="color: red">
                                    <h:outputLabel value="S/." />
                                    <h:outputLabel value="#{orderController.sic1docu.numMtodscto}" />
                                </td>
                            </tr>
                            <tr style="height: 10px">
                                <td></td>
                            </tr>
                            <tr style="color: white; border-top: 1px inset #2C3259 ; font-size: 15px">
                                <td class="compra_totales_label">
                                    <h:outputLabel  value="SUB. TOTAL:" />
                                </td>
                                <td class="compra_totales_text">
                                    <h:outputLabel value="S/." />
                                    <h:outputLabel value="#{orderController.sic1docu.numSubtotal}" />
                                </td>
                            </tr>

                            <tr style="color: white; border-top: 1px inset #2C3259; font-size: 15px">
                                <td class="compra_totales_label">
                                    <h:outputLabel  value="IGV(18%):" />
                                </td>
                                <td class="compra_totales_text">
                                    <h:outputLabel value="S/." />
                                    <h:outputLabel value="#{orderController.sic1docu.numIgv}" />
                                </td>
                            </tr>   

                            <tr style="color: white; border-top: 1px inset #2C3259; font-size: 21px ">
                                <td class="compra_totales_label" >
                                    <h:outputLabel  value="TOTAL:" />
                                </td>
                                <td class="compra_totales_text">
                                    <h:outputLabel value="S/." />
                                    <h:outputLabel id="numMtoTotal" value="#{orderController.sic1docu.numMtoTotal}" />
                                </td>
                            </tr>
                            
                            <!--Se muestra el vuelto -->
                            <tr style="color: white; border-top: 1px inset #2C3259; text-align: center">
                                <td colspan="2">
                                    <h:panelGroup rendered="#{orderController.flgIsSale}" >
                                        <div class="calcularVuelto">VUELTO: #{orderController.sic1docu.numMtovuelto}</div>
                                    </h:panelGroup>
                                </td>
                            </tr>                           
                            

                        </table>
                    </h:panelGroup>
                </div>


                <!-- ****************************************************************************** -->
                <!-- GRABAR -->
                <!-- ****************************************************************************** -->                
                <div style="margin: 30px 0px" class="offset-sm-2 col-sm-10">
                    <h:commandButton id="btnFinishOrder"
                                   value="Finalizar Operación"
                                   rendered="false"
                                   styleClass="btn btn-danger"
                                   onclick="return fnFinishOrder()" >
                    </h:commandButton>
                </div>               
                

                <!-- ****************************************************************************** -->
                <!-- ELEMENTOS OCULTOS -->
                <!-- ****************************************************************************** -->
                <table class="ocultarObjeto">
                    <tr>
                        <td><label>CodTRolpers:</label></td>
                        <td><input type="text" id="idCodTRolpers" disabled="true" value="${orderController.codTRolpersExterno}"/></td>
                    </tr>
                    <tr>
                        <td><p:commandLink id="idBtnHideFinishOrder" value="Finalizar Orden" actionListener="#{orderController.finishPendingOrder()}" update="form" /></td>
                    </tr>
                </table>
                
                <p:commandButton id="btnImprimirVoucher" value="Imprimir Voucher"  style="display: none" actionListener="#{orderController.imprimirVoucher()}" ajax="false" />
                
            </div>

        </ui:define>
    </ui:composition>
</html>
