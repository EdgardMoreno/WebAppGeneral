<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" >

    <f:metadata>
        <f:viewParam name="paramExternalPage" value="#{productController.paramPageFlgActivo}"/>
        <f:viewParam name="paramCodProd" value="#{productController.sic1prod.codProd}"/>
    </f:metadata>

    <h:head>
        <title>Mantenimiento Producto</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta charset="utf-8"/>

        <!--CSS STYLE -->
        <h:outputStylesheet name="/datepicker/css/datepicker.css"/><!--DatePicker -->
        <h:outputStylesheet name="/css/bootstrap.min.css"/>
        <h:outputStylesheet name="/css/customizer.css"/>
        <h:outputStylesheet name="/css/jquery-confirm-3.3.css"/>        

        <!--JAVASCRIPT-->
        <script src="#{request.contextPath}/faces/resources/js/jquery-3.2.1.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" />
        <script src="#{request.contextPath}/faces/resources/js/customizerJS.js"></script>
        <script src="#{request.contextPath}/faces/resources/datepicker/js/bootstrap-datepicker.js"></script>
        <script src="#{request.contextPath}/faces/resources/datepicker/js/formatDatePicker.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="#{request.contextPath}/faces/resources/js/jquery-confirm-3.3.js"></script>

        <script>
            
            function fnAjaxListenSaveProduct(data) {
                
                console.log("Grabando producto");
                var flgParam = $("#form\\:idFlgPaginaExterna").val();
                /*Pregunta si la pagina ha sido llamada desde una pagina externa*/
                if(Number(flgParam) == 1){
                    
                    switch (data.status) {
                        case "success":

                        var idProd = $("#form\\:idProducto").val();
                        alert("idProd:" + Number(idProd));
                        if (Number(idProd) > 0){
                            parent.$.fancybox.close();   
                            parent.fnCloseIFrame_fromRegisterProduct();
                        }
                        break;
                    }
                }
            }
   

        </script>

    </h:head>
    <h:body>        

        <div class="container">

            <div id="divResultadoValidacion"/>
            
            <div class="page-header" >
                <h3>Registrar Producto</h3>
            </div>

            <h:form id="form">

                <p:growl id="message" showDetail="true" />

                <h:panelGrid id="pgRegProduct" columns="2"  style="width:80%" columnClasses="label_panelGrid_2c, text_panelGrid_2c">

                    <h:outputLabel value="CÃ³digo Producto:"/>
                    <h:inputText id="codigoProducto"
                                 styleClass="form-control left"
                                 disabled="#{productController.flgEditProd or productController.paramPageFlgActivo==1?true:false}"
                                 style="width:30%"
                                 value="#{productController.sic1prod.codProd}"/>

                    <h:outputLabel value="Nombre Producto:"/>
                    <h:inputText id="nombreProducto"
                                 styleClass="form-control left"
                                 style="width:60%"
                                 value="#{productController.sic1prod.desProd}"/>

                    <h:outputLabel value="Tipo Producto:" />
                    <h:selectOneMenu id="tipoProducto" style="width:60%" value="#{productController.sic1prod.idStipoprod}" styleClass="form-control">
                        <f:selectItem itemLabel="-- Seleccione --" itemValue="-1" noSelectionOption="true"/>
                        <f:selectItems value="#{productController.items}" />
                    </h:selectOneMenu>

                    <h:outputLabel value="Precio Venta:"/>
                    <h:panelGroup>
                        <div class="input-group mb-2 mb-sm-0">
                            <div class="input-group-addon">S/.</div>
                            <h:inputText id="precioVenta" styleClass="form-control"
                                         style="width:25%"
                                         value="#{productController.sic1prod.numPrecio}"
                                         onkeypress="return fnAllowOnlyDecimalNumbers(event)"
                                         onblur="formatDecimal_2(this)"/>
                        </div>
                    </h:panelGroup>
                    
                    <h:outputLabel value="Id Producto:" />
                    <h:outputLabel id="idProducto" value="#{productController.idProd}" />
                    
                    <h:outputLabel value="flgPaginaExterna" style="display: none"/>
                    <h:inputText id="idFlgPaginaExterna" value="#{productController.paramPageFlgActivo}" />

                </h:panelGrid>

                <br/>    
                <div class="offset-sm-2 col-sm-10">                    
                    <input type="button" id="btnConfirm" value="Grabar" class="btn btn-primary" onclick="return fnValidateForm()"/>
                    <input type="button" id="btnConfirm" value="Cancelar" class="btn btn-primary" onclick="parent.$.fancybox.close();"/>
                </div>
                
                <h:commandButton id="btnGrabar" style="display: none">
                    <f:ajax execute="form" render="@form" listener="#{productController.saveProduct()}" onevent="fnAjaxListenSaveProduct"/>
                </h:commandButton>

            </h:form>

        </div>

    </h:body>
</html>
